<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- <meta charset="utf-8"> -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="description" content="MockPass is a mock SingPass/CorpPass server for dev purposes.">
        <!-- Add to homescreen for Chrome on Android -->
        <meta name="mobile-web-app-capable" content="yes">
        <!-- Add to homescreen for Safari on iOS -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="Web Starter Kit">
        <link rel="icon" type="img/ico" href="/mockpass/resources/img/favicon.ico">
        <title>Mockpass Login</title>
        <link rel="icon" href="/mockpass/resources/img/logo/favicon.svg"/>
        <link rel="stylesheet" type="text/css" href="/mockpass/resources/plugins/bootstrap-3.3.6/css/bootstrap.min.css" media="all">
        <link rel="stylesheet" type="text/css" href="/mockpass/resources/css/style-main.css" media="all">
        <link rel="stylesheet" type="text/css" href="/mockpass/resources/css/common.css" media="all">
        <link rel="stylesheet" type="text/css" href="/mockpass/resources/css/animate.css" media="all">
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@govtechsg/sgds@2.2.0/css/sgds.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
        <link rel="stylesheet" type="text/css" href="/mockpass/resources/css/login.css" media="all">

        <script src="/mockpass/resources/js/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <script src="/mockpass/resources/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script type="text/javascript" src="/mockpass/resources/js/login-common.js"></script>
            
        <script 
        type="module" 
        src="https://cdn.jsdelivr.net/npm/@govtechsg/sgds-web-component@1.4.0/components/Masthead/index.umd.js">
        </script>
    </head>
    <body>
        <sgds-masthead></sgds-masthead>
        <div style="height: auto" class="overflow-auto bg-light shadow">
            <div class="container container-fluid">
                <nav class="sgds navbar pt-2 pb-2" style="padding-left: 0;">
                    <a class="navbar-brand" style="padding-left: 0;">
                        <img src="/mockpass/resources/img/logo/singpass-logo.bdceeae1.svg" alt="Logo" height="75%" class="d-inline-block align-text-top">
                    </a>
                </nav>
            </div>
        </div>
        <div class="homepagebody-wrapper" style="height: auto;">
            <div class="announcement-container" style="padding-top: 15px; padding-bottom: 15px;">
                <div class="container container-fluid" style="border: none; background-color: transparent;">
                    <div class="sgds accordion" id="accordionExample" style="background-color: transparent;border: none; margin-left: 0; padding-left: 0;">
                        <div class="accordion-item" style="border: none; background-color: transparent;margin-left: 0; padding-left: 0;">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" style="padding-left: 0;border: none; background-color: transparent; color: rgb(32, 30, 37); font-size: 24px; font-weight: 600;"
                                    aria-expanded="false" aria-controls="collapseOne">
                                    Beware of scam calls, SMS or emails
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" style="padding-left: 0;"
                                data-bs-parent="#accordionExample">
                                <div class="accordion-body" style="padding-left: 0;">
                                    We were alerted to users receiving calls informing them of an urgent Singpass account termination. This call is a scam and not from Singpass. Please do not follow the instructions or respond to the scammer. Call the Singpass hotline to report it immediately.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sp-img-bg" style="background-color: transparent; height: auto; min-height: auto;">
                <div class="overlay">
                    <div class="container container-fluid" style="padding-top: 3rem; padding-bottom: 3rem;">
                        <div class="centered-content">
                            <div class="col col-lg-8 col-sm-12" style="align-content: center;">
                                <div class="row login-header">
                                    <div class="col col-lg-2">
                                        <img src="/mockpass/resources/img/logo/icon-sp-mascot.56e6db83.svg" alt="Singpass Logo"> <!-- Replace with your logo URL -->
                                    </div>
                                    <div class="col col-lg-10">
                                        <h2 class="mt-2" style="text-align: start; color: rgb(32, 30, 37);">Log in with Mockpass</h4>
                                        <p style="text-align: start; color: rgb(32, 30, 37);">Your trusted digital identity</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col col-lg-4 col-sm-12">
                                <div class="login-card" style="color: #474747; min-height: 600px;">
                                    <ul class="nav nav-tabs mb-3" >
                                        <li class="nav-item" style="width: 50%;">
                                            <a class="nav-link active" href="#" id="login-tab">Login</a>
                                        </li>
                                        <li class="nav-item" style="width: 50%;">
                                            <a class="nav-link" href="#" id="register-tab">Register</a>
                                        </li>
                                    </ul>
                                    <div id="login-form">
                                        <form id="login" name="LoginForm" class="innate-form" method="post">
                                            <div id="LoginForm">
                                                <div class="mb-3">
                                                    <label for="username-select">Username</label>
                                                    <select id="username-select" name="username" class="form-select" style="margin: 9px 0; width: 100%; border: 2px solid #ccc; border-radius: 5px; background: white; color: rgb(42, 45, 51);">
                                                        <option value="" disabled selected>Select Username</option>
                                                        {{#values}}
                                                            <option value="{{ id }}" data-asserturl="{{ assertURL }}">{{ id }}</option>
                                                        {{/values}}
                                                    </select>
                                                </div>
                                            </div>
                                            <div>
                                                <input type="hidden" name="CSRFToken" value="null" />
                                            </div>
                                            <div>
                                                <button type="submit" id="loginSubmit" class="btn btn-primary w-100">Login</button>
                                            </div>
                                        </form>
                                        
                                    </div>
                                    
                                    <div id="register-form" style="display:none;">
                                        {{#customProfileConfig}}
                                        <form action="{{registerEndpoint}}" class="innate-form" method="post">

                                            <label for="nric">NRIC</label>
                                            <input type="text" name="nric" id="nric" value="" placeholder="S1234567A" minlength="9" maxlength="9"  style="width: 100%; border: 2px solid #ccc; border-radius: 5px; background: white; color: rgb(42, 45, 51);">
                                            <br>

                                            
                                            {{#showName}}
                                            <label for="name">Name</label>
                                            <input type="text" name="name" id="name" value="" placeholder="Name" minlength="1" maxlength="36"  style="width: 100%; border: 2px solid #ccc; border-radius: 5px; background: white; color: rgb(42, 45, 51);">
                                            <br>
                                            {{/showName}}

                                            
                                            {{#showSingpass}}
                                            <label for="isSingpass">Singpass Holder?
                                            </label>
                                            <br>
                                            <input type="checkbox" name="isSingpass" id="isSingpass" value=false style="width: 100%; border: 2px solid #ccc; border-radius: 5px; background: white; color: rgb(42, 45, 51);">
                                            <br>
                                            {{/showSingpass}}

                                            {{#showUuid}}
                                            <label for="uuid">UUID</label>
                                            <input type="text" name="uuid" id="uuid" value="" placeholder="ef39a074-b64d-4990-a937-6f80772e2bb8" minlength="36" maxlength="36" style="width: 100%; border: 2px solid #ccc; border-radius: 5px; background: white; color: rgb(42, 45, 51);">
                                            <br>
                                            {{/showUuid}}

                                            {{#showUen}}
                                            <label for="uen">UEN</label>
                                            <input type="text" name="uen" id="uen" value="" placeholder="123456789D" minlength="9" maxlength="10" style="width: 100%; border: 2px solid #ccc; border-radius: 5px; background: white; color: rgb(42, 45, 51);">
                                            <br>
                                            {{/showUen}}

                                            {{#assertEndpoint}}<input type="hidden" name="assertEndpoint" value="{{ assertEndpoint }}" />{{/assertEndpoint}}
                                            {{#redirectURI}}<input type="hidden" name="redirectURI" value="{{ redirectURI }}" />{{/redirectURI}}
                                            {{#relayState}}<input type="hidden" name="relayState" value="{{ relayState }}" />{{/relayState}}
                                            {{#state}}<input type="hidden" name="state" value="{{ state }}" />{{/state}}
                                            {{#nonce}}<input type="hidden" name="nonce" value="{{ nonce }}" />{{/nonce}}

                                            <br>
                                            <button autofocus="" type="submit" id="registerSubmit" class="btn btn-primary w-100">Register</button>
                                            <br>
                                        </form>
                                        {{/customProfileConfig}}
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="sgds footer" >
            <section class="footer-top" style="background-color: #474747;">
                <div class="container container-fluid">
                    <div class="row">
                        <div class="col">
                            <div class="row footer-header" style="padding-top: 1rem; padding-bottom: 1 rem;">
                                <div class="col col-lg-6 col-md-12" >
                                    <img src="/mockpass/resources/img/logo/singpass-logo-white.b764b183.svg" alt="Home" height="30">
                                </div>
                            </div>
                            <div class="row footer-contact-links">
                                <div class="d-flex justify-content-lg">
                                    <ul>
                                        <li><a href="">Contact</a></li>
                                        <li><a href="">Feedback</a></li>
                                        <li><a href="https://www.reach.gov.sg/" target="_blank"
                                                rel="noopener noreferrer">Reach.gov.sg</a></li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="row footer-mandatory-links">
                                <div class="col d-flex justify-content-lg">
                                    <ul>
                                        <li><a href="https://tech.gov.sg/report_vulnerability" target="_blank"
                                                rel="noopener noreferrer">Report Vulnerability</a></li>
                                        <li><a href="">Privacy Statement</a></li>
                                        <li><a href="">Terms of use</a></li>
                                    </ul>
                                </div>
                        
                                <div class="col footer-copyrights">
                                    <div class="d-flex justify-content-lg-end text-end">
                                        © 2024 Government of Singapore<br>
                                        Last Updated 31 Aug 2024
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </footer>
        <script>

            document.getElementById('login').addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent the form from submitting normally
                
                var selectElement = document.getElementById('username-select');
                var selectedOption = selectElement.options[selectElement.selectedIndex];
                var assertUrl = selectedOption.getAttribute('data-asserturl');

                if (assertUrl) {
                    window.location.href = assertUrl; // Redirect to the data-asserturl value
                } else {
                    alert('Please select a username with a valid redirect URL.');
                }
            });
           document.querySelector('button[id="registerSubmit"]').addEventListener('click', function(event) {
                const nricInput = document.getElementById('nric');
                const uenInput = document.getElementById('uen'); // Might be null if not present
                let isDuplicateNric = false;
                let isDuplicateUen = false;

                const options = document.querySelectorAll('option');

                options.forEach(option => {
                    const text = option.textContent;

                    // Extract NRIC from SingPass or CorpPass formats
                    const singPassMatch = text.match(/\(([^)]+)\)\s*(?:\[MyInfo\])?/); // Matches "Name (NRIC) [MyInfo]" or "Name (NRIC)"
                    const nricFromOption = singPassMatch ? singPassMatch[1] : null;

                    // Check for duplicate NRIC
                    if (nricFromOption === nricInput.value.trim()) {
                        isDuplicateNric = true;
                    }

                    // Extract UEN from CorpPass format
                    const corpPassMatch = text.match(/\/ UEN: (\w+)$/); // Matches "/ UEN: UEN"
                    const uenFromOption = corpPassMatch ? corpPassMatch[1] : null;

                    // Check for duplicate UEN
                    if (uenInput && uenFromOption === uenInput.value.trim()) {
                        isDuplicateUen = true;
                    }
                });

                // Handle NRIC validation
                if (nricInput.value.trim() === '') {
                    nricInput.style.border = '2px solid red'; // Set red border on empty input
                    if (!nricInput.nextElementSibling || !nricInput.nextElementSibling.classList.contains('warning')) {
                        const warningMessage = document.createElement('span');
                        warningMessage.className = 'warning';
                        warningMessage.style.color = 'red';
                        warningMessage.textContent = 'NRIC cannot be empty.';
                        nricInput.parentNode.insertBefore(warningMessage, nricInput.nextSibling);
                    }
                    event.preventDefault(); // Prevent form submission
                } else if (isDuplicateNric) {
                    nricInput.style.border = '2px solid red'; // Set red border on duplicate
                    if (!nricInput.nextElementSibling || !nricInput.nextElementSibling.classList.contains('warning')) {
                        const warningMessage = document.createElement('span');
                        warningMessage.className = 'warning';
                        warningMessage.style.color = 'red';
                        warningMessage.textContent = 'This NRIC already exists.';
                        nricInput.parentNode.insertBefore(warningMessage, nricInput.nextSibling);
                    }
                    event.preventDefault(); // Prevent form submission
                } else {
                    nricInput.style.border = ''; // Remove red border if not duplicate
                    if (nricInput.nextElementSibling && nricInput.nextElementSibling.classList.contains('warning')) {
                        nricInput.nextElementSibling.remove(); // Remove warning message if exists
                    }
                }

                // Handle UEN validation if the UEN field is displayed
                if (uenInput) {
                    if (uenInput.value.trim() === '') {
                        uenInput.style.border = '2px solid red'; // Set red border on empty input
                        if (!uenInput.nextElementSibling || !uenInput.nextElementSibling.classList.contains('warning')) {
                            const warningMessage = document.createElement('span');
                            warningMessage.className = 'warning';
                            warningMessage.style.color = 'red';
                            warningMessage.textContent = 'UEN cannot be empty.';
                            uenInput.parentNode.insertBefore(warningMessage, uenInput.nextSibling);
                        }
                        event.preventDefault(); // Prevent form submission
                    } else if (isDuplicateUen) {
                        uenInput.style.border = '2px solid red'; // Set red border on duplicate
                        if (!uenInput.nextElementSibling || !uenInput.nextElementSibling.classList.contains('warning')) {
                            const warningMessage = document.createElement('span');
                            warningMessage.className = 'warning';
                            warningMessage.style.color = 'red';
                            warningMessage.textContent = 'This UEN already exists.';
                            uenInput.parentNode.insertBefore(warningMessage, uenInput.nextSibling);
                        }
                        event.preventDefault(); // Prevent form submission
                    } else {
                        uenInput.style.border = ''; // Remove red border if not duplicate
                        if (uenInput.nextElementSibling && uenInput.nextElementSibling.classList.contains('warning')) {
                            uenInput.nextElementSibling.remove(); // Remove warning message if exists
                        }
                    }
                }
            });

            // Add event listeners to NRIC and UEN inputs for removing warnings on change
            const nricInput = document.getElementById('nric');
            const uenInput = document.getElementById('uen'); // Might be null if not present

            nricInput.addEventListener('input', function() {
                nricInput.style.border = ''; // Remove red border
                if (nricInput.nextElementSibling && nricInput.nextElementSibling.classList.contains('warning')) {
                    nricInput.nextElementSibling.remove(); // Remove warning message
                }
            });

            if (uenInput) {
                uenInput.addEventListener('input', function() {
                    uenInput.style.border = ''; // Remove red border
                    if (uenInput.nextElementSibling && uenInput.nextElementSibling.classList.contains('warning')) {
                        uenInput.nextElementSibling.remove(); // Remove warning message
                    }
                });
            }
            document.getElementById('login-tab').addEventListener('click', function() {
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('register-form').style.display = 'none';
                this.classList.add('active');
                document.getElementById('register-tab').classList.remove('active');
            });

            document.getElementById('register-tab').addEventListener('click', function() {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
                this.classList.add('active');
                document.getElementById('login-tab').classList.remove('active');
            });


            </script>
            
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
            
    </body>
</html>
